# SaunaScopeBot - Краткое описание проекта

**Автор:** Rimas Kavaliauskas  
**Дата:** Ноябрь 2024  
**Домашняя работа для Profile School**

---

## Что это?

**SaunaScopeBot** — это автономный AI-агент, работающий на платформе Cloudflare Workers, который мониторит сайты саун и велнес-центров, автоматически находит новые события и курсы, и присылает уведомления в Telegram.

## Основная функциональность

Бот сканирует добавленные пользователем сайты каждые 6 часов, анализирует их контент с помощью Google Gemini AI, извлекает структурированную информацию о событиях (дата, цена, место), и сохраняет в базу данных D1. При обнаружении новых событий пользователь получает уведомление прямо в Telegram. Бот также автоматически обнаруживает новые релевантные сайты, анализируя внешние ссылки на уже мониторимых страницах.

## Ключевые технологии

Проект полностью построен на serverless-инфраструктуре Cloudflare: Workers для бэкенда, D1 для базы данных, Browser (Puppeteer) для рендеринга JavaScript-сайтов, и Cron Triggers для автоматического запуска. В качестве AI-движка используется Google Gemini 2.0 Flash Lite для анализа контента, понимания естественного языка и извлечения структурированных данных. Интерфейс реализован через Telegram Bot API, что позволяет управлять ботом прямо из мессенджера.

## Conversational AI (новое!)

Недавно была добавлена продвинутая функциональность разговорного AI. Теперь бот умеет использовать инструменты: выполнять запросы к базе данных (`query_database`), искать информацию в интернете через Exa.ai с получением полного текста страниц (`search_exa`), анализировать внешние URL (`analyze_url`), и проводить глубокий анализ конкретных событий (`analyze_event_by_id`). Это позволяет общаться с ботом на естественном языке: "Найди правила финской сауны" → бот ищет, читает страницы и выдает структурированный ответ.

## Команда `/analyze_event`

Добавлена специальная команда для детального AI-анализа событий. При вызове `/analyze_event [ID]` бот посещает страницу события, читает её содержимое и генерирует структурированный отчёт с разделами: обзор события, причины посетить, для кого подходит, практические советы и итоговая рекомендация. Отчёт форматируется с использованием HTML-тегов и эмодзи для лучшей читаемости в Telegram.

## Управление поведением

Вся "личность" и поведение бота управляется через текстовые промпты в файле `src/lib/prompts.js`. Можно изменить тематику мониторинга (например, с саун на рыбалку или театры), просто отредактировав текстовые инструкции для AI — никакого программирования не требуется. Промпты были значительно усилены агрессивными директивами ("YOU MUST use tools", "NEVER refuse"), чтобы преодолеть склонность модели Gemini 2.0 Flash Lite к "лени".

## Архитектура

Система построена по принципу event-driven architecture: Telegram webhook → Router (маршрутизация команд) → Services (Scraper, Analyzer, Conversation, Database) → Gemini AI → Database → Telegram notifications. Все компоненты работают асинхронно и масштабируются автоматически на платформе Cloudflare. Реализованы продвинутые функции: дедупликация событий с fuzzy matching, рекурсивное обнаружение новых сайтов, поддержка мультиязычности, и извлечение конкретных ссылок на события (а не только главных страниц).

## Результаты

Проект полностью функционален и задеплоен на Cloudflare Workers. Бот успешно мониторит несколько десятков сайтов, нашёл более 40 событий, и корректно обрабатывает как прямые команды (`/add`, `/list`, `/events`), так и естественный язык. Conversational AI демонстрирует способность к многошаговому рассуждению: поиск в интернете → чтение текста → извлечение нужной информации → структурированный ответ.

## Полная документация

Подробное описание проекта, архитектуры, всех функций и того, как управлять поведением бота, находится в файле **`PROJECT_GUIDE.md`** в корне проекта. Там представлена схема работы системы (Mermaid-диаграмма), описание всех ролей AI, инструкция по изменению промптов, список команд, технический стек, и план развития проекта.

---

**Git-коммиты:**
- "Домашняя работа - Stable version with all features" (989185d) — базовая версия
- "Вечер понедельника перед сдачей домашней работы" (f94b1d5) — финальная версия с Conversational AI
